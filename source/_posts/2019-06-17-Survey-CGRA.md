---
title: '[Survey] CGRA'
tags: [Survey, CGRA]
categories: [General Concept]
mathjax: false
date: 2019-06-14 12:15:12
---

## 摘要

计算密集型应用的硬件加速往往通过映射技术将密集计算映射（Mapping）到[可重构计算（Reconfigurable Computing, RC）][1]芯片上。而一般而言，应用执行时间主要消耗在少量的循环处。因此，可重构计算芯片上的循环映射优化对于提升计算密集型应用的执行性能具有重要意义。
CGRA（Coarse-Grained Reconfigurable Architecture）是一种可重构计算架构，字面翻译为粗粒度可重构处理器。其基础处理单元（Processing Element, PE）为指令级别（Word-Level）的，区别于FPGA（Field Programable Gate Array, 现场可编程门阵列）的门级别，能够直接实现一些典型的逻辑计算。由于CGRA上特殊的硬件结构以及循环程序中语句复杂的依赖关系，CGRA上的循环映射也存在着挑战。

<!-- more -->

## 可重构处理器体系结构

### 硬件简介及基本属性

组成：
PE组成的Array由一个类mesh风格的内部连线连接起来的架构

属性：
由于大量的资源因此有高吞吐量
而分布式的硬件带来低功耗
动态可编程则提供高灵活性

主要参数：
大小：PE 数量，一般构成一个正方形的阵列，一般4*4～8*8，也有32*32
互连形式：crossbar；mesh；mesh plus；morphosys……
寄存器共享方式：完全分布式；bus行列分布式；中央寄存器式；混合式
PE 功能：同构/异构；ALU功能类型；PE动态功能……

### 硬件分类

根据程序运行的过程中阵列的电路结构是否改变，分为：

- 静态可重构：如FPGA
- 动态可重构：如CGRA

根据阵列互连形式的不同，CGRA主要分为：

- 一维互连CGRA
- 二维互连CGRA

## [可重构处理器编译技术][2]

### 编译对可重构计算的重要性

由于可重构处理器和通用处理器的硬件结构有很大的不同，可重构处理器编译器的编译流程和生成的可执行文件都有很大的不同。

- 通用处理器的编译是将应用程序编译生成单一目标处理器的汇编指令和机器码。
- 而可重构处理器编译器则首先要对应用程序进行软硬件划分，把应用程序中适合硬件加速的计算密集型部分划分出来。然后针对两部分分别作编译处理，分别生产运行在主控制器控制码和可重构计算阵列上配置信息。

因此，我们所熟知的串行编程模式不能够被直接应用在可重构处理器上。可重构处理器编译是一个极具挑战性的工作。如果没 有易用的编译器，编程人员则需要非常熟悉可重构处理器的底层硬件结构来进行 开发。这将大大降低可重构处理器的通用性。因此，可重构处理器编译器对于可 重构处理器具有极为重要的作用。

## CGRA循环映射技术

**为何要针对循环进行映射优化？**

因为在现代实际生活应用程序中(例如:声音、图像处理等应用)，循环往往占据了这些程序的大部分运行时间。循环的特点是多次重复同一个计算内核（Kernel），不改变运算的结构，只改变运算的数据。[2][2]

因此循环映射技术往往是针对从某类应用程序中抽象出的计算内核来进行优化的。

### CGRA映射（Mapping）技术

根据PE在映射时的功能，可分为两类映射技术：

- 空间映射：主要针对一维互连架构
- 时域映射：主要针对二维互连架构

根据可重构计算阵列的**运算模式**，可分为下列两种情况：

- 一次配置多次执行：由于少量的配置，可以大大节省配置的开销，从而可以提高性能，降低功耗。
- 一次配置一次执行：提高来可配置性，但大大降低可重构处理器的执行性能，功耗也会大大增加。

总之，降低配置次数对于提高可重构处 理器的性能是非常有帮助的。

#### 挑战

- **多层嵌套**循环如何处理，以降低内外循环之间交互的开销，同时保证各个循环之间执行顺序的正确性。
- 由于循环间的**数据依赖**，如何在限定的空间资源和时序约束中进行合法的布局布线也是一个难点。
  - 选取合适的循环变换可以改变数据依赖的形式，以更好得进行映射，因此如何选择循环变换方法就是一个挑战；
  - 硬件资源有限，如何充分地利用有限的各类硬件资源对于循环映射也是一个挑战：
    - 有限的配置存储资源：如果配置存储资源不够，动态可重构的能力会非常受限。因此，如何在循环映射的时候减少配置代价是一个难点；
    - 稀疏的计算和互连资源：由于芯片面积和功耗的限制，计算阵列的规模一般不大，且阵列中计算单元之间的互连资源一般也比较稀疏；
    - 有限的数据存储资源：主要体现在带宽和存储空间上，由于芯片面积和功耗的限制，阵列中只有某些处理单元能够访问数据存储器；

### 调度算法

### 布局布线

[1]: https://doi.org/10.1109/JPROC.2014.2386883 "Tessier, R., Pocek, K., & DeHon, A. (2015). Reconfigurable Computing Architectures. Proceedings of the IEEE, 103(3), 332–354."
[2]: http://kns.cnki.net/KCMS/detail/detail.aspx?dbcode=CDFD&dbname=CDFDLAST2017&filename=1017800368.nh&v=MDc1MDRHYnU0SHRMS3A1RWJQSVI4ZVgxTHV4WVM3RGgxVDNxVHJXTTFGckNVUkxPZlllZHBGQ3JrVXJ6QlZGMjY= "刘大江. 可重构处理器编译系统中循环优化关键技术研究[D].清华大学,2015."
